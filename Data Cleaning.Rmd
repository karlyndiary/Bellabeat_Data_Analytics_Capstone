---
title: "Data Cleaning"
output: html_document
date: "`r Sys.Date()`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:


# 1. Document description 

This document outlines all of the steps taken to clean and transform Cyclistic's raw datasets to prepare the data for the next stage of analysis. For the purpose of this case study, only data collected between August 2020 - July 2021 will be assessed. The dataset description can be located [here.](https://www.divvybikes.com/system-data)

Please note that Cyclistic is a fictional company. Raw data has been collected by Motivate International Inc, the company which operates the City of Chicago's Divvy bicycle sharing service. The license to use this public dataset can be found [here.](https://www.divvybikes.com/data-license-agreement)

## 2 Loading libraries
```{r load packages}
library(tidyverse) #drop_na()
library(lubridate)
library(janitor) #clean_names()
library(dplyr)
library(ggplot2)
library(highcharter)
```

### 2.1 Loading Datasets

```{r load datasets}
daily_activity <- read.csv("/cloud/project/dailyActivity_merged.csv")
sleep_day <- read.csv("/cloud/project/sleepDay_merged.csv")
weight_log_info <- read.csv("/cloud/project/weightLogInfo_merged.csv")
```

### 2.2 Summary of dataframes
```{r explore dataframes}
str(daily_activity) 
str(sleep_day)
str(weight_log_info) 
```

### 2.3 Changing case from camel case to snake case
```{r changing case}
daily_activity <- clean_names(daily_activity)
sleep_day <- clean_names(sleep_day)
weight_log_info <- clean_names(weight_log_info)
```

### 2.4 Checking for duplicates
```{r}
sum(duplicated(daily_activity))
sum(duplicated(sleep_day))
sum(duplicated(weight_log_info))
```

### 2.5 Deleting duplicates
```{r}
# Before deleting duplicates
nrow(sleep_day)

# Command to clear duplicates
sleep_day <- sleep_day %>%
  distinct() %>%
  drop_na()

# After deleting duplicates
nrow(sleep_day)
```

### 2.6 Changing datatype for date from char to date datatype
```{r Changing datatype for date from char to date datatype}
daily_activity$activity_date <- as.Date(daily_activity$activity_date,'%m/%d/%y')
sleep_day$sleep_day <- as.Date(sleep_day$sleep_day,'%m/%d/%y')
weight_log_info$date <- as.Date(weight_log_info$date,'%m/%d/%y')
```

### 2.7 Renaming column activity_date and sleep_day to date
```{r renaming column activity_date and sleep_day to date}
daily_activity <- daily_activity %>%
  rename(date = activity_date)

sleep_day <- sleep_day %>%
  rename(date = sleep_day)
```

### 2.8 Converting minutes to hours for total_minutes_asleep
```{r}
#total hours asleep
sleep_day$total_hours_asleep = round((sleep_day$total_minutes_asleep)/60, digits = 2)

str(sleep_day)
```

### 2.9 Formatting String datatype to Boolean datatype
```{r}
weight_log_info$is_manual_report <- as.logical(weight_log_info$is_manual_report)

str(weight_log_info)
```
### 2.10 Creating a new column for weekdays
```{r}
# Adding a new column for weekdays
daily_activity$day_of_week <- wday(daily_activity$date, label = T, abbr = T)

# After adding the weekday column
str(daily_activity)
```

### 2.11 Merging daily_activity and sleep_day dataset
```{r}
daily_activity_sleep <- merge(daily_activity, sleep_day, by=c ("id", "date"))
daily_activity_weight <- merge(daily_activity, weight_log_info, by=c ("id", "date"))

str(daily_activity_sleep)
str(daily_activity_weight)
```